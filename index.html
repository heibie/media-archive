---
layout: default
title: B√ºcher
---

<style>
:root{
  --gap:16px;
  --muted:#6b7280;
  --border:#e5e7eb;
  --chip:#eef2ff;
  --bar:#e5e7eb;
  --bar-fill:#6366f1;
}
.controls{margin:10px 0 20px 0; display:flex; flex-wrap:wrap; gap:10px; align-items:center}
.controls .group{display:flex; gap:8px; align-items:center; flex-wrap:wrap}
.controls label{font-size:14px; color:var(--muted)}
.controls input[type="search"], .controls select{
  padding:8px 10px; border:1px solid var(--border); border-radius:8px; min-width:200px;
}
.controls .toggle{display:flex; gap:6px; align-items:center; font-size:14px; color:var(--muted)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:var(--gap)}
.card{border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#fff; display:flex; flex-direction:column}
.card img{width:100%;height:320px;object-fit:cover;background:#f3f4f6}
.card .body{padding:12px}
.badges{display:flex;flex-wrap:wrap;gap:6px;margin-top:6px}
.badge{font-size:12px;padding:2px 8px;border-radius:999px;background:var(--chip)}
.muted{color:var(--muted);font-size:14px}
h2{font-size:16px;margin:8px 0 4px 0; line-height:1.25}
.meta{display:flex; gap:6px; flex-wrap:wrap; align-items:center}
.meta .dot::before{content:"‚Ä¢"; margin:0 6px; color:var(--muted)}
.progress{margin-top:8px}
.progress .track{width:100%; height:10px; background:var(--bar); border-radius:999px; overflow:hidden}
.progress .fill{height:100%; background:var(--bar-fill); width:0%}
.pager{display:flex; gap:8px; justify-content:center; margin:20px 0 0}
.pager button{padding:8px 10px; border:1px solid var(--border); background:#fff; border-radius:8px; cursor:pointer}
.pager button[disabled]{opacity:.5; cursor:not-allowed}
</style>

<h1>üìö Gelesene B√ºcher</h1>

<div class="controls muted">
  <small>Quelle: <code>_data/read.yml</code> ‚Ä¢ neueste zuerst</small>
</div>

{% assign books_all = site.data.read | default: empty %}
{% assign books = books_all | where: "typ", "buch" %}
{% assign books = books | sort: "fertig_am" | reverse %}

{% assign all_status = "" | split: "" %}
{% assign all_years = "" | split: "" %}
{% for b in books %}
  {% if b.status %}{% assign all_status = all_status | push: b.status %}{% endif %}
  {% assign year_source = b.fertig_am | default: b.datum | default: b.hinzugefuegt_am | default: b.start_am %}
  {% if year_source %}
    {% assign y = year_source | date: "%Y" %}
    {% assign all_years = all_years | push: y %}
  {% endif %}
{% endfor %}
{% assign status_unique = all_status | uniq | sort %}
{% assign years_unique = all_years | uniq | sort | reverse %}

<div class="controls">
  <div class="group">
    <label for="q">Suche:</label>
    <input id="q" type="search" placeholder="Titel oder Autor‚Ä¶">
  </div>
  <div class="group">
    <label for="status">Status:</label>
    <select id="status">
      <option value="">(alle)</option>
      {% for s in status_unique %}
        {% if s %}<option value="{{ s | escape }}">{{ s }}</option>{% endif %}
      {% endfor %}
    </select>
  </div>
  <div class="group">
    <label for="year">Jahr:</label>
    <select id="year">
      <option value="">(alle)</option>
      {% for y in years_unique %}
        <option value="{{ y }}">{{ y }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="group">
    <label for="sort">Sortierung:</label>
    <select id="sort">
      <option value="newest">Neueste zuerst</option>
      <option value="oldest">√Ñlteste zuerst</option>
      <option value="rating_desc">Bewertung ‚Üì</option>
      <option value="rating_asc">Bewertung ‚Üë</option>
      <option value="title_asc">Titel A‚ÄìZ</option>
      <option value="title_desc">Titel Z‚ÄìA</option>
    </select>
  </div>
  <label class="toggle">
    <input id="hide-nocover" type="checkbox"> ohne Cover ausblenden
  </label>
</div>

<div id="grid" class="grid">
{% for b in books %}
  {%- assign cover = b.cover -%}
  {%- if (cover == nil or cover == "" or cover contains "nopic.png" or cover contains "/assets/placeholder.png") and b.isbn -%}
    {%- assign cover = "https://covers.openlibrary.org/b/isbn/" | append: b.isbn | append: "-L.jpg" -%}
  {%- endif -%}

  {%- assign authors_text = "" -%}
  {%- if b.autor -%}
    {%- if b.autor.size -%}{% assign authors_text = b.autor | join: ", " %}{%- else -%}{% assign authors_text = b.autor %}{%- endif -%}
  {%- endif -%}

  {%- assign status = b.status | default: "" -%}
  {%- assign pages = b.seiten | default: b.Seiten | default: "" -%}
  {%- assign progress = b.progress | default: "" -%}

  {%- assign date_source = "" -%}
  {%- if status == "finished" and b.fertig_am -%}
    {% assign date_source = b.fertig_am %}
  {%- elsif status == "currently reading" and b.start_am -%}
    {% assign date_source = b.start_am %}
  {%- elsif status == "to read" and b.hinzugefuegt_am -%}
    {% assign date_source = b.hinzugefuegt_am %}
  {%- endif -%}
  {%- assign date_source = date_source | default: b.datum | default: b.fertig_am | default: b.start_am | default: b.hinzugefuegt_am -%}
  {%- assign year = "" -%}
  {%- if date_source -%}{% assign year = date_source | date: "%Y" %}{%- endif -%}

  {%- assign date_label = "" -%}
  {%- if status == "finished" -%}
    {% assign date_label = "beendet" %}
  {%- elsif status == "to read" -%}
    {% assign date_label = "hinzugef√ºgt" %}
  {%- elsif status == "currently reading" -%}
    {% assign date_label = "gestartet" %}
  {%- endif -%}

  {%- assign rating = b.bewertung | default: 0 -%}
  {%- assign pct = "" -%}
  {%- if status == "currently reading" and pages and pages != 0 and progress and progress != 0 -%}
    {%- assign pct = progress | times: 100.0 | divided_by: pages | round -%}
  {%- endif -%}

  <article
    class="card"
    data-title="{{ b.titel | default: 'Ohne Titel' | downcase | escape }}"
    data-author="{{ authors_text | downcase | escape }}"
    data-status="{{ status | downcase | escape }}"
    data-year="{{ year }}"
    data-rating="{{ rating }}"
    data-date="{{ date_source }}"
  >
    <img
      loading="lazy"
      src="{{ cover | default: '/assets/placeholder.png' | relative_url }}"
      alt="Cover"
      onerror="this.onerror=null; this.dataset.error=1; this.src='{{ '/assets/placeholder.png' | relative_url }}'; this.closest('.card').dataset.nocover='1'; if(document.getElementById('hide-nocover')?.checked){ this.closest('.card').style.display='none'; }"
    >
    <div class="body">
      <h2 title="{{ b.titel | escape }}">{{ b.titel | default: "Ohne Titel" }}</h2>
      {% if authors_text != "" %}
        <div class="muted">{{ authors_text }}</div>
      {% endif %}

      <div class="muted meta">
        {% if date_source %}
          <span>
            {% if date_label != "" %}{{ date_label }}{% else %}Datum{% endif %} 
            <span class="date" data-date="{{ date_source | escape }}"></span>
          </span>
        {% endif %}
        {% if rating %}<span class="dot">‚≠ê {{ rating }}</span>{% endif %}
        {% if b.isbn %}
          <span>
            ISBN <a href="https://www.isbn.de/search?s={{ b.isbn | uri_escape }}" target="_blank" rel="noopener">{{ b.isbn }}</a>
          </span>
        {% endif %}
        {% if status %}
          <span>Status {{ status }}</span>
        {% endif %}
      </div>

      {% if pct != "" and pct > 0 and pct <= 100 %}
        <div class="progress" aria-label="Lesefortschritt">
          <div class="track">
            <div class="fill" style="width: {{ pct }}%"></div>
          </div>
          <div class="muted" style="margin-top:4px">{{ progress }}/{{ pages }} Seiten ({{ pct }}%)</div>
        </div>
      {% endif %}

      {% if b.tags %}
        <div class="badges">
          {% for t in b.tags %}<span class="badge">#{{ t }}</span>{% endfor %}
        </div>
      {% endif %}
      {# ‚ÄûQuelle‚Äú-Link entf√§llt vollst√§ndig #}
    </div>
  </article>
{% endfor %}
</div>

<div class="pager" id="pager" hidden>
  <button id="prev" disabled>Zur√ºck</button>
  <span id="pageinfo" class="muted"></span>
  <button id="next">Weiter</button>
</div>

<script>
(function(){
  const q = document.getElementById('q');
  const selStatus = document.getElementById('status');
  const selYear = document.getElementById('year');
  const selSort = document.getElementById('sort');
  const hideNoCover = document.getElementById('hide-nocover');
  const grid = document.getElementById('grid');
  const cards = Array.from(grid.querySelectorAll('.card'));
  const pager = document.getElementById('pager');
  const prev = document.getElementById('prev');
  const next = document.getElementById('next');
  const pageinfo = document.getElementById('pageinfo');

  let page = 1;
  const perPage = 48;

  function normalize(s){ return (s||"").toLowerCase(); }
  function parseDateISO(s){ const t = Date.parse(s||""); return isNaN(t) ? 0 : t; }

  // Format deutsche Datumsanzeige
  function formatGermanDate(iso){
    try{
      const d = new Date(iso);
      if(isNaN(+d)) return iso || "";
      return d.toLocaleDateString('de-DE', { day:'numeric', month:'long', year:'numeric' });
    }catch(e){ return iso || ""; }
  }

  function applySort(list){
    const mode = selSort.value;
    return list.sort((a,b)=>{
      if(mode === 'newest' || mode === 'oldest'){
        const da = parseDateISO(a.dataset.date);
        const db = parseDateISO(b.dataset.date);
        return mode==='newest' ? (db-da) : (da-db);
      }
      if(mode === 'rating_desc' || mode === 'rating_asc'){
        const ra = parseFloat(a.dataset.rating||0);
        const rb = parseFloat(b.dataset.rating||0);
        return mode==='rating_desc' ? (rb-ra) : (ra-rb);
      }
      if(mode === 'title_asc' || mode === 'title_desc'){
        const ta = a.dataset.title || '';
        const tb = b.dataset.title || '';
        return mode==='title_asc' ? ta.localeCompare(tb) : tb.localeCompare(ta);
      }
      return 0;
    });
  }

  function filter(){
    const term = normalize(q?.value || "");
    const status = normalize(selStatus.value);
    const year = selYear.value;
    const noCover = hideNoCover.checked;

    let visible = cards.filter(card=>{
      if(noCover && card.dataset.nocover === '1') return false;

      const t = card.dataset.title;
      const a = card.dataset.author;
      if(term && !(t.includes(term) || a.includes(term))) return false;

      if(status){
        const s = (card.dataset.status || '');
        if(s !== status) return false;
      }

      if(year && card.dataset.year !== year) return false;

      return true;
    });

    visible = applySort(visible);

    const total = visible.length;
    const pages = Math.max(1, Math.ceil(total / perPage));
    if(page > pages) page = pages;

    cards.forEach(c=>c.style.display='none');

    const start = (page-1)*perPage;
    const end = start + perPage;
    visible.slice(start, end).forEach(c=>c.style.display='flex');

    if(total > perPage){
      pager.hidden = false;
      prev.disabled = (page<=1);
      next.disabled = (page>=pages);
      pageinfo.textContent = `Seite ${page} / ${pages} ‚Ä¢ ${total} Treffer`;
    } else {
      pager.hidden = true;
    }
  }

  [q, selStatus, selYear, selSort, hideNoCover].forEach(el=>el.addEventListener('input', ()=>{ page=1; filter(); }));
  prev.addEventListener('click', ()=>{ if(page>1){ page--; filter(); }});
  next.addEventListener('click', ()=>{ page++; filter(); });

  // Markiere No-Cover und formatiere Datumsfelder
  cards.forEach(card=>{
    const img = card.querySelector('img');
    if(img && (img.currentSrc.includes('/assets/placeholder.png') || img.dataset.error === '1')){
      card.dataset.nocover='1';
    }
    const ds = card.dataset.date;
    const dateSpan = card.querySelector('.date');
    if(dateSpan && ds){
      dateSpan.textContent = formatGermanDate(ds);
    }
  });

  filter();
})();
</script>
