---
layout: default
title: Bücher
---

<h1>📚 Gelesene Bücher</h1>

<div class="controls muted">
  <small>Quelle: <code>_data/read.yml</code> • neueste zuerst</small>
</div>

{% assign books_all = site.data.read | default: empty %}
{% assign books = books_all | where: "typ", "buch" %}
{% assign books = books | sort: "fertig_am" | reverse %}

{% comment %} Filterlisten bauen (inkl. eingetragen_am & gestartet_am) {% endcomment %}
{% assign all_status = "" | split: "" %}
{% assign all_years = "" | split: "" %}
{% for b in books %}
  {% if b.status %}
    {% assign s_arr = b.status | append: '' | split: '__' %}
    {% assign all_status = all_status | concat: s_arr %}
  {% endif %}
  {% assign year_source = b.fertig_am | default: b.eingetragen_am | default: b.hinzugefuegt_am | default: b.start_am | default: b.gestartet_am | default: b.datum %}
  {% if year_source %}
    {% assign y = year_source | date: "%Y" %}
    {% assign y_arr = y | split: '__' %}
    {% assign all_years = all_years | concat: y_arr %}
  {% endif %}
{% endfor %}
{% assign status_unique = all_status | uniq | sort %}
{% assign years_unique = all_years | uniq | sort | reverse %}

<div class="controls">
  <div class="group">
    <label for="q">Suche:</label>
    <input id="q" type="search" placeholder="Titel oder Autor…">
  </div>
  <div class="group">
    <label for="status">Status:</label>
    <select id="status">
      <option value="">(alle)</option>
      {% for s in status_unique %}{% if s %}<option value="{{ s | escape }}">{{ s }}</option>{% endif %}{% endfor %}
    </select>
  </div>
  <div class="group">
    <label for="year">Jahr:</label>
    <select id="year">
      <option value="">(alle)</option>
      {% for y in years_unique %}<option value="{{ y }}">{{ y }}</option>{% endfor %}
    </select>
  </div>
  <div class="group">
    <label for="sort">Sortierung:</label>
    <select id="sort">
      <option value="newest">Neueste zuerst</option>
      <option value="oldest">Älteste zuerst</option>
      <option value="rating_desc">Bewertung ↓</option>
      <option value="rating_asc">Bewertung ↑</option>
      <option value="title_asc">Titel A–Z</option>
      <option value="title_desc">Titel Z–A</option>
    </select>
  </div>
  <label class="toggle">
    <input id="hide-nocover" type="checkbox"> ohne Cover ausblenden
  </label>
</div>

<div id="grid" class="grid">
{% comment %} … (Karten-Template bleibt exakt wie bei dir) … {% endcomment %}
{% for b in books %}
  {% assign cover = b.cover %}
  {% assign isbn_str = b.isbn | append: '' %}
  {% if (cover == nil or cover == "" or cover contains "nopic.png" or cover contains "/assets/placeholder.png") and b.isbn %}
    {% assign cover = "https://covers.openlibrary.org/b/isbn/" | append: isbn_str | append: "-L.jpg" %}
  {% endif %}

  {% assign authors_text = "" %}
  {% if b.autor %}
    {% if b.autor.size %}{% assign authors_text = b.autor | join: ", " %}{% else %}{% assign authors_text = b.autor %}{% endif %}
  {% endif %}

  {% assign status_raw = b.status | default: "" %}
  {% assign status = status_raw | downcase | strip %}
  {% assign pages_num = b.seiten | default: b.Seiten | default: 0 | plus: 0 %}
  {% assign progress_num = b.progress | default: 0 | plus: 0 %}
  {% assign rating_num = b.bewertung | replace: ",","." | default: 0 | plus: 0 %}
  {% if status == "to read" %}{% assign status = "want to read" %}{% endif %}

  {% assign date_label = "" %}
  {% assign date_value = "" %}
  {% if status == "finished" %}
    {% assign date_label = "beendet" %}
    {% assign date_value = b.fertig_am | default: b.eingetragen_am | default: b.datum %}
  {% elsif status == "want to read" %}
    {% assign date_label = "hinzugefügt" %}
    {% assign date_value = b.eingetragen_am | default: b.hinzugefuegt_am | default: b.datum %}
  {% elsif status == "currently reading" %}
    {% assign date_label = "gestartet" %}
    {% assign date_value = b.start_am | default: b.gestartet_am | default: b.eingetragen_am | default: b.datum %}
  {% else %}
    {% assign date_value = b.eingetragen_am | default: b.fertig_am | default: b.datum %}
  {% endif %}

  {% assign year = "" %}{% if date_value %}{% assign year = date_value | date: "%Y" %}{% endif %}
  {% assign rating_for_sort = rating_num %}
  {% assign pct = "" %}
  {% if status == "currently reading" and pages_num > 0 and progress_num > 0 %}
    {% assign pct = progress_num | times: 100.0 | divided_by: pages_num | round %}
  {% endif %}

  {% assign is_pin = 0 %}
  {% if status == "currently reading" and (b.fertig_am == nil or b.fertig_am == "") %}
    {% assign is_pin = 1 %}
  {% endif %}

  <article class="card"
    data-title="{{ b.titel | default: 'Ohne Titel' | downcase | escape }}"
    data-author="{{ authors_text | downcase | escape }}"
    data-status="{{ status | downcase | escape }}"
    data-year="{{ year }}"
    data-rating="{{ rating_for_sort }}"
    data-date="{{ date_value }}"
    data-pin="{{ is_pin }}"
  >
    {% if status == "currently reading" %}
      <span class="badge badge-running" title="Aktuell in Arbeit">📖 läuft</span>
    {% endif %}
    <img loading="lazy"
      src="{{ cover | default: '/assets/placeholder.png' | relative_url }}"
      alt="Cover"
      onerror="this.onerror=null; this.dataset.error=1; this.src='{{ '/assets/placeholder.png' | relative_url }}'; this.closest('.card').dataset.nocover='1'; if(document.getElementById('hide-nocover')?.checked){ this.closest('.card').style.display='none'; }"
    >
    <div class="body">
      <h2 title="{{ b.titel | escape }}">{{ b.titel | default: "Ohne Titel" }}</h2>
      {% if authors_text != "" %}<div class="muted">{{ authors_text }}</div>{% endif %}

      <div class="muted meta">
        {% if date_value %}
          <span>{% if date_label != "" %}{{ date_label }} am{% else %}am{% endif %}
            <span class="date" data-date="{{ date_value | escape }}"></span>
          </span>
        {% endif %}

        {% if rating_num > 0 %}
          <span class="dot">⭐ {{ rating_num }}</span><br>
        {% endif %}

        {% if b.isbn %}
          <span>ISBN <a href="https://www.isbn.de/buch/{{ isbn_str | uri_escape }}/" target="_blank" rel="noopener">{{ isbn_str }}</a></span>
        {% endif %}

        {% if status %}<span>Status: {{ status }}</span>{% endif %}
      </div>

      {% if pct != "" and pct > 0 and pct <= 100 %}
        <div class="progress" aria-label="Lesefortschritt">
          <div class="track"><div class="fill" style="width: {{ pct }}%"></div></div>
          <div class="muted" style="margin-top:4px">{{ progress_num }}/{{ pages_num }} Seiten ({{ pct }}%)</div>
        </div>
      {% endif %}
    </div>
  </article>
{% endfor %}
</div>

<div class="pager" id="pager" hidden>
  <button id="prev" disabled>Zurück</button>
  <span id="pageinfo" class="muted"></span>
  <button id="next">Weiter</button>
</div>

<script>
/* dein bestehendes JS aus der Buch-Seite bleibt 1:1 erhalten */
</script>
